// =============================================================
// ðŸ“Œ trendAI.js â€” Zihin Platformu (v6.6 Final)
// Trend Analizi â€¢ Ã–ÄŸrencinin zaman iÃ§indeki geliÅŸim eÄŸrisi
// =============================================================

console.log("trendAI.js (v6.6) yÃ¼klendi âœ”");


// -------------------------------------------------------------
// ðŸ”§ GÃ¼venli deÄŸer alma fonksiyonu
// -------------------------------------------------------------
function safe(val) {
  return typeof val === "number" && !isNaN(val) ? val : 0;
}


// -------------------------------------------------------------
// 1) Ham veriden trend tablolarÄ±nÄ± hazÄ±rla
// -------------------------------------------------------------
export function getTrendData(history) {
  if (!Array.isArray(history) || history.length === 0) return null;

  return {
    dogru: history.map(h => safe(h.dogru)),
    yanlis: history.map(h => safe(h.yanlis)),
    reaction: history.map(h => safe(h.skorlar?.reaction_speed)),
    attention: history.map(h => safe(h.skorlar?.sustained_attention)),
    inhibition: history.map(h => safe(h.skorlar?.inhibitory_control)),
    labels: history.map((_, i) => `Oyun ${i + 1}`)
  };
}


// -------------------------------------------------------------
// 2) Trend grafiÄŸini Ã§iz
// -------------------------------------------------------------
export function drawTrendLines(canvas, history) {
  if (!canvas || !history || history.length === 0) return;

  const dataset = getTrendData(history);
  if (!dataset) return;

  const ctx = canvas.getContext("2d");
  if (!ctx) return;

  new Chart(ctx, {
    type: "line",
    data: {
      labels: dataset.labels,
      datasets: [
        {
          label: "Tepki HÄ±zÄ±",
          data: dataset.reaction,
          borderColor: "#0066ff",
          backgroundColor: "rgba(0,102,255,0.15)",
          borderWidth: 3,
          tension: 0.3,
          pointRadius: 4
        },
        {
          label: "Dikkat SÃ¼rekliliÄŸi",
          data: dataset.attention,
          borderColor: "#fbc02d",
          backgroundColor: "rgba(251,192,45,0.18)",
          borderWidth: 3,
          tension: 0.3,
          pointRadius: 4
        },
        {
          label: "Ä°nhibisyon",
          data: dataset.inhibition,
          borderColor: "#e53935",
          backgroundColor: "rgba(229,57,53,0.18)",
          borderWidth: 3,
          tension: 0.3,
          pointRadius: 4
        }
      ]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: "top" }
      },
      scales: {
        y: {
          min: 0,
          max: 100,
          ticks: { stepSize: 20 }
        }
      }
    }
  });
}