// ============================================================
// ğŸ“Œ profile.js â€” KullanÄ±cÄ± Profil Bilgisi (Final v6.4)
// Zihin Platformu tam uyumlu â€” KÄ±rÄ±lmaz yapÄ±da
// ============================================================

import { auth } from "../data/firebaseConfig.js";
import { watchAuthState, logout } from "../auth/auth.js";
import { ROLES, yonlendir } from "../platform/router.js";

console.log("profile.js yÃ¼klendi âœ”");

// ============================================================
// ğŸ” 1) KullanÄ±cÄ± Oturum KontrolÃ¼
// ============================================================
//
// Bu dosya yalnÄ±zca giriÅŸ yapÄ±lmÄ±ÅŸ bir kullanÄ±cÄ± varsa Ã§alÄ±ÅŸÄ±r.
// EÄŸer kullanÄ±cÄ± yoksa â†’ login.htmlâ€™e yÃ¶nlendirilir.
//
watchAuthState(async user => {
  if (!user) {
    console.warn("ğŸš« KullanÄ±cÄ± oturumu yok â†’ login.html");
    window.location.href = "login.html";
    return;
  }

  console.log("ğŸ‘¤ Profil yÃ¼kleniyor:", user.email);

  // Email
  const emailEl = document.getElementById("email");
  if (emailEl) emailEl.textContent = user.email;

  // UID
  const uidEl = document.getElementById("uid");
  if (uidEl) uidEl.textContent = user.uid;

  // Rol (localStorage â†’ Firestore ile uyumlu)
  const roleEl = document.getElementById("role");
  const role = localStorage.getItem("role") || ROLES.OGRENCI;

  if (roleEl) roleEl.textContent = role;

  // Ã–ÄŸretmen ID (yalnÄ±zca Ã¶ÄŸrenci iÃ§in anlamlÄ±)
  const teacherEl = document.getElementById("teacherID");
  const teacherID = localStorage.getItem("teacherID");

  if (teacherEl) teacherEl.textContent = teacherID || "-";

});

// ============================================================
// ğŸšª 2) Ã‡Ä±kÄ±ÅŸ Butonu
// ============================================================
const logoutBtn = document.getElementById("logoutBtn");

if (logoutBtn) {
  logoutBtn.onclick = async () => {
    await logout();

    console.log("ğŸ‘‹ KullanÄ±cÄ± Ã§Ä±kÄ±ÅŸ yaptÄ± â†’ login.html");
    window.location.href = "login.html";
  };
}

// ============================================================
// ğŸ” 3) Profil EkranÄ± Rol GÃ¼venliÄŸi
// ============================================================
// Profil tÃ¼m roller tarafÄ±ndan gÃ¶rÃ¼lebilir.
// Ama istenirse burada role baÄŸlÄ± UI gizleme ekleri yapÄ±labilir.
//
(function rolKontrol() {
  const role = localStorage.getItem("role");

  if (!role) {
    console.warn("âš  Profil rolÃ¼ bulunamadÄ±!");
    return;
  }

  console.log("ğŸ” Profil gÃ¶rÃ¼ntÃ¼lendi. Rol:", role);

})();