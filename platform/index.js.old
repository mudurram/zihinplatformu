// =====================================================
// üìå index.js ‚Äî Zihin Platformu Ana Men√º (Final Version)
// =====================================================

import { GAME_MAP } from "./globalConfig.js";

// =====================================================
// üîç Kullanƒ±cƒ± Bilgisi ‚Äî LocalStorage
// =====================================================
function aktifKullaniciBilgisi() {
  try {
    return JSON.parse(localStorage.getItem("aktifKullanici")) || null;
  } catch {
    return null;
  }
}

function aktifOgrenciBilgisi() {
  const id = localStorage.getItem("aktifOgrenciId") || null;
  const ad = localStorage.getItem("aktifOgrenci") || null;
  return { id, ad };
}

// =====================================================
// üöÄ Sayfa Y√ºklenince
// =====================================================
document.addEventListener("DOMContentLoaded", () => {
  const user = aktifKullaniciBilgisi();
  const ogr = aktifOgrenciBilgisi();

  // =====================================
  // üë§ Kullanƒ±cƒ± Bilgisi Yazdƒ±r
  // =====================================
  const kullaniciEl = document.getElementById("kullaniciAd");
  if (kullaniciEl && user) {
    const isim = user.username || user.email || "-";
    const rol = user.role || "-";

    kullaniciEl.textContent = `üë§ Kullanƒ±cƒ±: ${isim} (${rol})`;
  }

  // =====================================
  // üéì Aktif √ñƒürenci Bilgisi Yazdƒ±r
  // =====================================
  const ogrEl = document.getElementById("aktifOgrenci");
  if (ogrEl && ogr?.ad) {
    ogrEl.textContent = `üéì Aktif √ñƒürenci: ${ogr.ad}`;
  }

  // =====================================
  // üéÆ Oyun Kartlarƒ±nƒ± Olu≈ütur
  // =====================================
  const grid = document.getElementById("oyunGrid");
  if (!grid) {
    console.warn("‚ö† oyunGrid bulunamadƒ± (index.html kontrol edilmeli)");
    return;
  }

  grid.innerHTML = "";

  Object.keys(GAME_MAP).forEach(key => {
    const oyun = GAME_MAP[key];

    // G√ºvenlik: Oyun verisi yoksa ge√ß
    if (!oyun || !oyun.path) return;

    const kart = document.createElement("div");
    kart.className = "oyunKart";

    kart.innerHTML = `
      <div class="oyunBaslik">${oyun.ad || "Oyun"}</div>
      <div class="oyunAlt">${oyun.kategori || "-"}</div>
    `;

    kart.onclick = () => {
      window.location.href = oyun.path;
    };

    grid.appendChild(kart);
  });
});