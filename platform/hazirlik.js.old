// =============================================================
// ðŸ“Œ hazirlik.js â€” Oyun HazÄ±rlÄ±k EkranÄ± (Final, Stabil, GLOBAL Uyumlu)
// =============================================================

import { GLOBAL } from "./globalConfig.js";
import { ROLES } from "./router.js";

document.addEventListener("DOMContentLoaded", () => {

  // ---------------------------------------------------------
  // 1) ROL KONTROLÃœ
  // ---------------------------------------------------------
  const role = localStorage.getItem("role");
  const aktifOgrenciId = localStorage.getItem("aktifOgrenciId");

  // Ã–ÄŸretmense â†’ Ã¶ÄŸrenci seÃ§miÅŸ olmalÄ±
  if (role === ROLES.OGRETMEN && !aktifOgrenciId) {
    alert("â„¹ Oyunu baÅŸlatmadan Ã¶nce bir Ã¶ÄŸrenci seÃ§melisiniz.");
    window.location.href = "teacher_panel.html";
    return;
  }

  // Admin / Editor oyuna giremez
  if (role === ROLES.ADMIN || role === ROLES.EDITOR) {
    alert("â›” Bu ekran admin/editor hesabÄ± iÃ§in kullanÄ±labilir deÄŸildir.");
    window.location.href = "index.html";
    return;
  }

  // ---------------------------------------------------------
  // 2) OYUN KODU AL
  // ---------------------------------------------------------
  const oyunKodu =
    localStorage.getItem("secilenOyunKodu") ||
    localStorage.getItem("secilenOyun") ||
    localStorage.getItem("seciliOyun");

  if (!oyunKodu) {
    console.warn("âš  Oyun kodu bulunamadÄ±.");
    yazdir("Oyun BulunamadÄ±", "LÃ¼tfen ana menÃ¼den bir oyun seÃ§iniz.");
    return;
  }

  // ---------------------------------------------------------
  // 3) GLOBAL ÃœZERÄ°NDEN OYUN ADI + YOLU
  // ---------------------------------------------------------
  const oyunYolu = GLOBAL.OYUN_YOLLARI[oyunKodu];
  const oyunAdi =
    GLOBAL.OYUN_ADLARI[oyunKodu] ||
    oyunKodu.replace("_", " ").toUpperCase();

  if (!oyunYolu) {
    console.warn("âš  GLOBAL.OYUN_YOLLARI iÃ§inde oyun tanÄ±mÄ± bulunamadÄ±:", oyunKodu);
    yazdir("TanÄ±mlanamayan Oyun", "Bu oyun sistemde kayÄ±tlÄ± deÄŸil.");
    return;
  }

  // ---------------------------------------------------------
  // 4) EKRANA YAZ
  // ---------------------------------------------------------
  const aciklama =
    "Bu oyun Zihin Platformu dikkat modÃ¼llerinden biridir. BaÅŸlamak iÃ§in hazÄ±rlanÄ±n.";

  yazdir(oyunAdi, aciklama);

  // ---------------------------------------------------------
  // 5) BAÅžLAT BUTONU
  // ---------------------------------------------------------
  const baslaBtn = document.getElementById("baslaBtn");

  if (baslaBtn) {
    baslaBtn.onclick = () => {
      window.location.href = oyunYolu;
    };
  }

  // ---------------------------------------------------------
  // 6) YAZDIRMA FONKSÄ°YONU
  // ---------------------------------------------------------
  function yazdir(baslik, aciklama) {
    const baslikEl = document.getElementById("hazirlikBaslik");
    const acikEl = document.getElementById("hazirlikMetni");

    if (baslikEl) baslikEl.textContent = baslik;
    if (acikEl) acikEl.innerHTML = aciklama;
  }

});