// =============================================================
// ðŸ“Œ heatmap.js â€” Renk HatalarÄ± HeatMap Motoru (Final v6.4)
// =============================================================
//
// Bu modÃ¼l Ã¶zellikle AyÄ±rt Etme oyununda renk bazlÄ± hatalarÄ±
// gÃ¶rsel olarak gÃ¶stermek iÃ§in kullanÄ±lÄ±r.
//
// - KÄ±rÄ±lma yapmaz
// - Canvas responsive olarak Ã¶lÃ§eklenir
// - Mobil / tablet / PC uyumludur
//
// =============================================================

export function drawHeatmap(canvas, renkBazliVeri) {
  if (!canvas) {
    console.warn("âš  heatmap: Canvas bulunamadÄ±.");
    return;
  }
  if (!renkBazliVeri || typeof renkBazliVeri !== "object") {
    console.warn("âš  heatmap: Veri geÃ§ersiz.");
    return;
  }

  const ctx = canvas.getContext("2d");
  const style = getComputedStyle(canvas);

  // -------------------------------------------------------------
  // ðŸ“Œ 1) GERÃ‡EK Piksel BoyutlarÄ±nÄ± Ayarla (Retina fix)
  // -------------------------------------------------------------
  const displayWidth = parseInt(style.width);
  const displayHeight = parseInt(style.height);

  canvas.width = displayWidth * devicePixelRatio;
  canvas.height = displayHeight * devicePixelRatio;

  ctx.scale(devicePixelRatio, devicePixelRatio);

  // -------------------------------------------------------------
  // ðŸ“Œ 2) Heatmap veri kontrolÃ¼
  // -------------------------------------------------------------
  const renkler = Object.keys(renkBazliVeri);
  if (renkler.length === 0) return;

  const maxHata = Math.max(...Object.values(renkBazliVeri), 1);
  const colWidth = displayWidth / renkler.length;

  ctx.clearRect(0, 0, displayWidth, displayHeight);

  // -------------------------------------------------------------
  // ðŸ“Œ 3) Her renk iÃ§in sÃ¼tun Ã§iz
  // -------------------------------------------------------------
  renkler.forEach((renk, i) => {
    const hataSayisi = renkBazliVeri[renk];
    const oran = hataSayisi / maxHata;

    // ðŸ”¥ KÄ±rmÄ±zÄ± (Ã§ok hata) â†’ SarÄ± (az hata)
    const r = Math.round(255 * oran);
    const g = Math.round(220 * (1 - oran));
    const b = Math.round(80 * (1 - oran));

    ctx.fillStyle = `rgba(${r},${g},${b},0.92)`;
    ctx.fillRect(i * colWidth, 0, colWidth - 4, displayHeight - 34);

    // ---------------------------------------------------------
    // ðŸ“Œ Hata sayÄ±sÄ±
    // ---------------------------------------------------------
    ctx.fillStyle = "#fff";
    ctx.font = "bold 16px Segoe UI";
    ctx.textAlign = "center";
    ctx.fillText(
      hataSayisi,
      i * colWidth + colWidth / 2,
      22
    );

    // ---------------------------------------------------------
    // ðŸ“Œ Renk adÄ±
    // ---------------------------------------------------------
    ctx.fillStyle = "#222";
    ctx.font = "14px Segoe UI";
    ctx.fillText(
      renk,
      i * colWidth + colWidth / 2,
      displayHeight - 6
    );
  });

  console.log("ðŸŽ¨ heatmap Ã§izildi âœ”");
}