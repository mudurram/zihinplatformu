// =============================================================
// ðŸ“Œ trialLabeler.js â€” Trial Etiketleme Motoru (Final v6.4)
// =============================================================
//
// Her trial ham verisini analiz ederek ÅŸu 3 bileÅŸeni etiketler:
//  - reaction (tepki hÄ±zÄ±)
//  - inhibition (engel baskÄ±lama hatasÄ±)
//  - focus (dikkat kaybÄ±)
//
// Bu dosya tÃ¼m oyunlarla %100 uyumludur.
// =============================================================


// -------------------------------------------------------------
// ðŸŽ¯ 1) Trial ortalamalarÄ±nÄ± hesaplama
// -------------------------------------------------------------
function average(arr) {
  if (!arr || arr.length === 0) return 0;
  return arr.reduce((a, b) => a + b, 0) / arr.length;
}


// -------------------------------------------------------------
// ðŸ§  2) Trial Etiketleme
// -------------------------------------------------------------
export function labelTrials(trials) {
  if (!Array.isArray(trials) || trials.length === 0) return [];

  // Reaction sÃ¼relerini al
  const reactionTimes = trials
    .filter(t => typeof t.reaction_ms === "number" && t.reaction_ms > 0)
    .map(t => t.reaction_ms);

  const avgReaction = average(reactionTimes) || 600; // fallback

  return trials.map((trial, index) => {
    let labeled = { ...trial };

    // ---------------------------------------------------------
    // ðŸŸ¦ 1) DoÄŸru tepki â†’ "reaction"
    // ---------------------------------------------------------
    if (trial.correct === true && typeof trial.reaction_ms === "number") {
      labeled.component = "reaction";
    }

    // ---------------------------------------------------------
    // ðŸŸ¥ 2) YanlÄ±ÅŸ tepki â†’ "inhibition"
    // ---------------------------------------------------------
    if (trial.correct === false) {
      labeled.component = "inhibition";
    }

    // ---------------------------------------------------------
    // ðŸŸ¨ 3) Ã‡ok yavaÅŸ tepki â†’ "focus" (dikkat kaybÄ±)
    // ---------------------------------------------------------
    if (
      typeof trial.reaction_ms === "number" &&
      trial.reaction_ms > avgReaction * 1.35
    ) {
      labeled.component = "focus";
    }

    // ---------------------------------------------------------
    // ðŸŸª 4) Son 5 turda aÅŸÄ±rÄ± hata â†’ "focus"
    // ---------------------------------------------------------
    if (index >= 4) {
      const lastFive = trials.slice(index - 4, index + 1);
      const errors = lastFive.filter(t => t.correct === false).length;

      if (errors >= 3) {
        labeled.component = "focus";
      }
    }

    return labeled;
  });
}

console.log("ðŸ“˜ trialLabeler.js yÃ¼klendi (Final v6.4)");